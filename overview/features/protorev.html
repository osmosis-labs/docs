<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-overview docs-doc-id-features/protorev">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Protorev | Osmosis Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.osmosis.zone/img/osmosis-docs-card.png"><meta data-rh="true" name="twitter:image" content="https://docs.osmosis.zone/img/osmosis-docs-card.png"><meta data-rh="true" property="og:url" content="https://docs.osmosis.zone/overview/features/protorev"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-overview-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-overview-current"><meta data-rh="true" property="og:title" content="Protorev | Osmosis Docs"><meta data-rh="true" name="description" content="ProtoRev is a module that:"><meta data-rh="true" property="og:description" content="ProtoRev is a module that:"><link data-rh="true" rel="icon" href="/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.osmosis.zone/overview/features/protorev"><link data-rh="true" rel="alternate" href="https://docs.osmosis.zone/overview/features/protorev" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.osmosis.zone/overview/features/protorev" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://O18C1RUI3F-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Osmosis Docs" href="/opensearch.xml">









<link rel="preconnect" href="https://app.posthog.com">
<script>!function(t,e){var o,p,i,n;e.__SV||(window.posthog=e,e._i=[],e.init=function(r,s,a){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(i=t.createElement("script")).type="text/javascript",i.async=!0,i.src=s.api_host+"/static/array.js",(n=t.getElementsByTagName("script")[0]).parentNode.insertBefore(i,n);var g=e;for(void 0!==a?g=e[a]=[]:a="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset".split(" "),p=0;p<o.length;p++)c(g,o[p]);e._i.push([r,s,a])},e.__SV=1)}(document,window.posthog||[]),posthog.init("00",{api_host:"https://app.posthog.com"})</script>

<script src="https://tally.so/widgets/embed.js"></script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="c5b5e9fc-d025-4c12-b08e-9784d0e2161f" data-project-name="Osmosis" data-project-color="#7900B4" data-project-logo="https://app.osmosis.zone/tokens/osmo.svg" async></script><link rel="stylesheet" href="/assets/css/styles.792232e5.css">
<link rel="preload" href="/assets/js/runtime~main.925a436b.js" as="script">
<link rel="preload" href="/assets/js/main.c0207744.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo/light.svg" alt="Osmosis Docs" class="themedImage_ToTc themedImage--light_HNdA" height="26px" width="114px"><img src="/logo/dark.svg" alt="Osmosis Docs" class="themedImage_ToTc themedImage--dark_i4oU" height="26px" width="114px"></div></a><a class="navbar__item navbar__link" href="/overview/educate">Overview</a><a class="navbar__item navbar__link" href="/overview/integrate">Integrate</a><a class="navbar__item navbar__link" href="/overview/validate">Validate &amp; Run your Node</a><a class="navbar__item navbar__link" href="/overview/endpoints">Endpoints</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/overview/features">Features</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/osmosis-core">Develop</a><a href="https://github.com/osmosis-labs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon github-icon"></a><a href="https://discord.com/invite/osmosis" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon discord-icon"></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://app.osmosis.zone" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dev-portal-signup dev-portal-link">Launch Dex<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_mhZE"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/overview/educate">Overview</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/overview/integrate">Integrate</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/overview/validate">Validate &amp; Run your Node</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/overview/endpoints">Endpoints</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item red"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/overview/features">Features</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview/features">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview/features/concentrated-liquidity">Concentrated Liquidity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview/features/eip-1559">EIP-1559</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview/features/fee-abstraction">Fee Abstraction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview/features/ibc-hooks">IBC Hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview/features/ibc-rate-limit">IBC Rate Limit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview/features/superfluid">Superfluid Staking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/overview/features/tokenfactory">Token Factory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/overview/features/protorev">Protorev</a></li></ul></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Protorev</h1><h1>Abstract</h1><p>ProtoRev is a module that:</p><ol><li>Runs during the Posthandler (core trading execution) and Epoch Hook (keeper store updating)</li><li>In the posthandler of a tx, checks if that tx swaps (has SwapExactAmountIn or SwapExactAmountOut as Msgs)</li><li>If a tx swaps, generates routes related to the pool swapped against that may contain cyclic arbitrage opportunities after the user’s swap</li><li>For each route, determines the optimal amount of the asset to swap in that results in maximum amount of the same asset out (profit)</li><li>Compares profits and selects the route that generates the most profit and is greater than 0</li><li>Mints the optimal amount of asset to swap in from the Bank module (as determined previously)</li><li>Executes the MultiHopSwapExactAmountIn with the optimal input amount for the route</li><li>Burns the same amount of asset previously minted to execute the swap</li><li>Redistributes the profit captured back to the Osmosis ecosystem based on Governance.</li></ol><p>For ecosystem context about the purpose of the module, please see the ProtoRev governance proposal discussion: <a href="https://common.xyz/osmosis/discussion/7078-skip-x-osmosis-proposal-to-capture-mev-as-protocol-revenue-on-chain" target="_blank" rel="noopener noreferrer">https://common.xyz/osmosis/discussion/7078-skip-x-osmosis-proposal-to-capture-mev-as-protocol-revenue-on-chain</a></p><h1>Concepts</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cyclic-arbitrage">Cyclic Arbitrage<a class="hash-link" href="#cyclic-arbitrage" title="Direct link to heading">​</a></h2><p>Cyclic arbitrage is a series of swaps that results in more of the same asset that was initially swapped in. An example of this is as follows:</p><p>Assume there exist three pools with the following asset pairs:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">. A/B</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain">. B/C</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">. C/A</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A user executes a multi-hop swap that swaps between pools 1, 2, and 3 with the following outcome (user inputs 10A into pool 1, and receives 15A from pool 3):</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">User -</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> 10A -</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> Pool </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> 5B -</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> Pool </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> 20C -</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> Pool </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain"> -</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> 15A -</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> User</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This series of swaps is known as a cyclic swap because it starts and ends in the same asset. A cyclic swap is known as a cyclic arbitrage swap when the output amount is greater than the input amount, for the same asset.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cyclic-arbitrage-route">Cyclic Arbitrage Route<a class="hash-link" href="#cyclic-arbitrage-route" title="Direct link to heading">​</a></h2><p>A Cyclic Arbitrage Route describes an ordered set of pools that need to be swapped through in consecutive order to capture a cyclic arbitrage opportunity. A Cyclic Route can be determined without knowing current reserve ratios of pools by assessing if one can swap in an asset into the series of pools and receive the same asset out. </p><p>So for the same pools as the example above, an exhaustive list of Cyclic Routes are as follows:</p><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token number" style="color:rgb(181, 206, 168)">1.</span><span class="token plain"> A</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">B</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2.</span><span class="token plain"> B</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">C</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">3.</span><span class="token plain"> C</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">A</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Asset A in, Asset A Out</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Asset A in, Asset A Out</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Asset C in, Asset C Out</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Asset C in, Asset C Out</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Asset B in, Asset B Out</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># Asset B in, Asset B Out</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>What determines if a Cyclic Route is a Cyclic Arbitrage Route at any given state of the chain (state of pool reserves) is if there exists an amount of an asset to be swapped into the route that results in more of the same asset out (10A in, 10A+ Out).</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimal-amount-in-to-swap">Optimal Amount In to Swap<a class="hash-link" href="#optimal-amount-in-to-swap" title="Direct link to heading">​</a></h2><p>When given an ordered route against a specific chain state (state of pool reserves) where a cyclic arbitrage opportunity exists, one must then determine how much to swap in to capture maximum profits (where profits is defined as Asset Out Amount - Asset In Amount). </p><p>ProtoRev uses a binary search algorithm to determine the optimal amount in to swap, using functions from the PoolManager module for calculations and swap execution.</p><h1>State</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="state-object">State Object<a class="hash-link" href="#state-object" title="Direct link to heading">​</a></h2><p>The <code>x/protorev</code> module keeps the following objects in state:</p><table><thead><tr><th>State Object</th><th>Description</th><th>Key</th><th>Values</th><th>Store</th></tr></thead><tbody><tr><td>TokenPairArbRoutes</td><td>TokenPairRoutes tracks cyclic arb routes that can be used to create a MultiHopSwap given two denoms</td><td>[]byte{1} + []byte{inputDenom} +[]byte{outputDenom}</td><td>[]byte{TokenPairArbRoutes}</td><td>KV</td></tr><tr><td>DenomPairToPool</td><td>Tracks the pool ids of the highest liquidity pools matched with a given denom[]byte{2}</td><td>[]byte{2} + []byte{baseDenom} + []byte{denomToMatch}</td><td>[]byte{poolID}</td><td>KV</td></tr><tr><td>BaseDenoms</td><td>Tracks all of the base denominations that will be used to construct arbitrage routes</td><td>[]byte{3}</td><td>[]byte{[]BaseDenoms{}}</td><td>KV</td></tr><tr><td>NumberOfTrades</td><td>Tracks the number of trades protorev has executed</td><td>[]byte{4}</td><td>[]byte{numberOfTrades}</td><td>KV</td></tr><tr><td>ProfitsByDenom</td><td>Tracks the profits protorev has made</td><td>[]byte{5} + []byte{tokenDenom}</td><td>[]byte{sdk.Coin}</td><td>KV</td></tr><tr><td>TradesByRoute</td><td>Tracks the number of trades the module has executed on a given route</td><td>[]byte{6} + []byte{route}</td><td>[]byte{numberOfTrades}</td><td>KV</td></tr><tr><td>ProfitsByRoute</td><td>Tracks the profits the module has accumulated after trading on a given route</td><td>[]byte{7} + []byte{route}</td><td>[]byte{sdk.Coin}</td><td>KV</td></tr><tr><td>DeveloperAccount</td><td>Tracks the developer account for protorev</td><td>[]byte{8}</td><td>[]byte{sdk.AccAddress}</td><td>KV</td></tr><tr><td>DaysSinceModuleGenesis</td><td>Tracks the number of days since the module was initialized. Used to track profits that can be withdrawn by the developer account</td><td>[]byte{9}</td><td>[]byte{uint}</td><td>KV</td></tr><tr><td>DeveloperFees</td><td>Tracks the profits that the developer account can withdraw</td><td>[]byte{10} + []byte{tokenDenom}</td><td>[]byte{sdk.Coin}</td><td>KV</td></tr><tr><td>MaxPoolPointsPerTx</td><td>Tracks the maximum number of pool points that can be consumed per tx</td><td>[]byte{11}</td><td>[]byte{uint64}</td><td>KV</td></tr><tr><td>MaxPoolPointsPerBlock</td><td>Tracks the maximum number of pool points that can be consumed per block</td><td>[]byte{12}</td><td>[]byte{uint64}</td><td>KV</td></tr><tr><td>PoolPointCountForBlock</td><td>Tracks the number of pool points that have been consumed in this block</td><td>[]byte{13}</td><td>[]byte{uint64}</td><td>KV</td></tr><tr><td>LatestBlockHeight</td><td>Tracks the latest recorded block height</td><td>[]byte{14}</td><td>[]byte{uint64}</td><td>KV</td></tr><tr><td>PoolWeights</td><td>Tracks the weights (pool points) of the different pool types</td><td>[]byte{15}</td><td>[]byte{PoolWeights}</td><td>KV</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tokenpairarbroutes">TokenPairArbRoutes<a class="hash-link" href="#tokenpairarbroutes" title="Direct link to heading">​</a></h3><p>TokenPairArbRoutes are cyclic arbitrage routes that are not going to be captured by the highest liquidity method (described in state transitions below). If there is a cyclic arbitrage route that is frequently being utilized by searchers, <code>x/protorev</code> can manually enter this route - through the admin account - and allow it to be used for trading. Each TokenPairArbRoutes object tracks a directional swap of two assets, and associates the swap with cyclic routes. When the module sees a swap of (<code>token_in</code>, <code>token_out</code>), it will extract the <code>arb_routes</code> that should be used and will simulate trades and execute them if profitable.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// TokenPairArbRoutes tracks all of the hot routes for a given pair of tokens</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">message TokenPairArbRoutes </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  option </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">gogoproto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">equal</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Stores all of the possible hot paths for a given pair of tokens</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  repeated Route arb_routes </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Token denomination of the first asset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> token_in </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// Token denomination of the second asset</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> token_out </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Route is a hot route for a given pair of tokens</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">message Route </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  option </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">gogoproto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">equal</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// The pool IDs that are traversed in the directed cyclic graph (traversed left</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// -&gt; right)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  repeated Trade trades </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// The step size that will be used to find the optimal swap amount in the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// binary search</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> step_size </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">gogoproto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">customtype</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;github.com/cosmos/cosmos-sdk/types.Int&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">gogoproto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">nullable</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// Trade is a single trade in a route</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">message Trade </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  option </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">gogoproto</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">equal</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// The pool IDs that are traversed in the directed cyclic graph (traversed left</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// -&gt; right)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token builtin" style="color:rgb(86, 156, 214)">uint64</span><span class="token plain"> pool </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// The denom of token A that is traded</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> token_in </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)">// The denom of token B that is traded</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> token_out </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="denompairtopool">DenomPairToPool<a class="hash-link" href="#denompairtopool" title="Direct link to heading">​</a></h3><p>DenomPairToPool takes in a base denomination (read below) – denom that is used to build routes (ex. osmo, atom, usdc) – and a denom to match (akash, juno) and returns the highest liquidity pool id between the pair of denominations. For example, an input might look like (osmo, juno) —&gt; poolID: 5. This store is directly tied to the highest liquidity method (described in state transitions below). Each base denomination is going to have its own set of denominations it maps to.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="basedenoms">BaseDenoms<a class="hash-link" href="#basedenoms" title="Direct link to heading">​</a></h3><p>BaseDenoms are the denominations that are used to build the highest liquidity routes. This will be configurable by the admin account, but will always maintain at least <code>uosmo</code> as a base denom. A base denom just means the denomination that will be used to start and end a cyclic arbitrage route. Base denoms can be added on as needed basis. </p><p><strong><em>NOTE</em></strong>: BaseDenoms do have a priority that is directly tied down to the order in the list of base denoms that are used i.e. BaseDenoms that are closer to the front of the list will likely be simulated and executed more often than those later in the list. This is done by design so that we can prioritize certain denoms over others in order to simulate and execute the most profitable trades.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="numberoftrades">NumberOfTrades<a class="hash-link" href="#numberoftrades" title="Direct link to heading">​</a></h3><p>This will store the total number of arbitrage trades that <code>x/protorev</code> has executed since genesis. This gets incremented every time the module executes a trade.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="profitsbydenom">ProfitsByDenom<a class="hash-link" href="#profitsbydenom" title="Direct link to heading">​</a></h3><p>This will store the profits <code>x/protorev</code> has accumulated for a given denom.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tradesbyroute--profitsbyroute">TradesByRoute &amp; ProfitsByRoute<a class="hash-link" href="#tradesbyroute--profitsbyroute" title="Direct link to heading">​</a></h3><p>These stores allow users and researchers to query the number of cyclic arbitrage trades that have been executed by <code>x/protorev</code> on an cyclic arbitrage route as well as all of the profits captured on that same route. Routes are denoted by the pool ids in the route i.e. []uint64{1,2,3}.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="protorevenabled">ProtoRevEnabled<a class="hash-link" href="#protorevenabled" title="Direct link to heading">​</a></h3><p><code>x/protorev</code> can be enabled or disabled through governance. As a proposal is a stateful change, we store whether the module is currently enabled or disabled in the module.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adminaccount">AdminAccount<a class="hash-link" href="#adminaccount" title="Direct link to heading">​</a></h3><p>The admin account is set through governance and has permissions to set hot routes, the maximum number of pool points per transaction, maximum number of pool points per block, pool type weights, base denoms and the developer account. On genesis, the admin account is set to a trusted address that is stored on a ledger - currently configured to be the Skip dev team&#x27;s address. Note that governance has full ability to change this live on-chain, and this admin can at most prevent <code>x/protorev</code> from working. All the admin account&#x27;s controls have limits, so it can&#x27;t lead to a chain halt, excess processing time or prevention of swaps.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="developeraccount">DeveloperAccount<a class="hash-link" href="#developeraccount" title="Direct link to heading">​</a></h3><p>The developer account is set through a MsgSetDeveloperAccount tx. This is the account that will be able to withdraw a portion of the profits from <code>x/protorev</code> as specified by the Osmosis ↔ Skip proposal. Only the admin account has permission to make this message.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="dayssincemodulegenesis">DaysSinceModuleGenesis<a class="hash-link" href="#dayssincemodulegenesis" title="Direct link to heading">​</a></h3><p><code>x/protorev</code> will distribute 20% of profits to the developer account in year 1, 10% of profits in year 2, and 5% thereafter. To track how much profit can be distributed to the developer account at any given moment, we store the amount of days since module genesis.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="developerfees-deprecated-in-v16">DeveloperFees (DEPRECATED IN v16)<a class="hash-link" href="#developerfees-deprecated-in-v16" title="Direct link to heading">​</a></h3><p>DeveloperFees tracks the total amount of profit that can be withdrawn by the developer account. These fees are sent to the developer account, if set, every week through the <code>epoch</code> hook. If unset, the funds are held in the module account. All <code>x/protorev</code> profits are going to be stored on the module account.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="maxpoolpointspertx">MaxPoolPointsPerTx<a class="hash-link" href="#maxpoolpointspertx" title="Direct link to heading">​</a></h3><p>A pool point roughly corresponds to a millisecond of trading simulation and execution time. In order to bound the compute time of <code>x/protorev</code> , we set a maximum number of pool points (execution time) per transaction and per block. MaxPoolPointsPerTx tracks the maximum number of pool points that can be consumed in a given transaction. This is configurable (but bounded) by the admin account. We limit the number of pool points per transaction so that all <code>x/protorev</code> execution is not limited to the top of the block.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="maxpoolpointsperblock">MaxPoolPointsPerBlock<a class="hash-link" href="#maxpoolpointsperblock" title="Direct link to heading">​</a></h3><p>MaxPoolPointsPerBlock tracks the maximum number of pool points that can be consumed in a given block. This is configurable (but bounded) by the admin account. We limit the number of pool points per block so that the execution time of the <code>x/protorev</code> posthandler is reasonably bounded to ensure that block time remains as is.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="poolpointcountforblock">PoolPointCountForBlock<a class="hash-link" href="#poolpointcountforblock" title="Direct link to heading">​</a></h3><p>PoolPointCountForBlock tracks the number of pool points that have been consumed in the current block. Used to ensure that the module is not slowing down block speed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="latestblockheight">LatestBlockHeight<a class="hash-link" href="#latestblockheight" title="Direct link to heading">​</a></h3><p>LatestBlockHeight tracks the latest recorded block height. This is used to update and reset the pool point count within a block and after new blocks are proposed.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="poolweights">PoolWeights<a class="hash-link" href="#poolweights" title="Direct link to heading">​</a></h3><p>PoolWeights assigns each pool type to a number of pool points it will approximately consume. This tracks the pool points or weight of each pool type that can be traversed. This distinction is necessary because different pool types have different simulation and execution times.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// PoolWeights contains the weights of all of the different pool types. This</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// distinction is made and necessary because the execution time ranges</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// significantly between the different pool types. Each weight roughly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// corresponds to the amount of time (in ms) it takes to execute a swap on that</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// pool type.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> PoolWeights </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// The weight of a stableswap pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    StableWeight </span><span class="token builtin" style="color:rgb(86, 156, 214)">uint64</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;varint,1,opt,name=stable_weight,json=stableWeight,proto3&quot; json:&quot;stable_weight,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// The weight of a balancer pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    BalancerWeight </span><span class="token builtin" style="color:rgb(86, 156, 214)">uint64</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;varint,2,opt,name=balancer_weight,json=balancerWeight,proto3&quot; json:&quot;balancer_weight,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// The weight of a concentrated pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ConcentratedWeight </span><span class="token builtin" style="color:rgb(86, 156, 214)">uint64</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;varint,3,opt,name=concentrated_weight,json=concentratedWeight,proto3&quot; json:&quot;concentrated_weight,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="genesisstate">GenesisState<a class="hash-link" href="#genesisstate" title="Direct link to heading">​</a></h3><p>There is only one configurable parameter for the genesis state —&gt; whether protorev is enabled or not.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// GenesisState defines the protorev module&#x27;s genesis state.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> GenesisState </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Module Parameters</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Params Params </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,1,opt,name=params,proto3&quot; json:&quot;params&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h1>State Transitions</h1><p>The <code>protorev</code> module triggers state transitions in the <code>postHandler</code> , governance proposals, and admin account transactions. After each <code>sdk.Tx</code>, the <code>postHandler</code> will determine whether there were any <code>MsgSwapExactAmountIn</code> or <code>MsgSwapExactAmountOut</code> in the transaction. If so, the module gets all of the pools that were used in the swap(s), temporarily stores the pool ids accessed along with their respective tokenIn/tokenOut denoms, and then builds cyclic arbitrage routes for each pool swapped against.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="route-generation">Route Generation<a class="hash-link" href="#route-generation" title="Direct link to heading">​</a></h2><p>There are two primary methods for route generation: <strong>Highest Liquidity Pools</strong> and <strong>Hot Routes</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="highest-liquidity-pool-method">Highest Liquidity Pool Method<a class="hash-link" href="#highest-liquidity-pool-method" title="Direct link to heading">​</a></h3><p>The highest liquidity pool method will always create cyclic arbitrage routes that have three pools. The routes that are created will always start and end with one of the denominations that are stored in BaseDenoms. The pool swapped against that the <code>postHandler</code> processes will always be the 2nd pool in the three-pool cyclic arbitrage route. </p><p><strong>Highest Liquidity Pools:</strong> Updated via the daily epoch, the module iterates through all the pools and stores the highest liquidity pool for every asset that pairs with any of the base denominations the module stores (for example, the osmo/juno key will have a single pool id stored, that pool id having the most liquidity out of all the osmo/juno pools). New base denominations can be added or removed on an as needed basis by the admin account. A base denomination is just another way of describing the denomination we want to use for cyclic arbitrage. This store is then used to create routes at runtime after analyzing a swap. This store is updated through the <code>epoch</code> hook and when the admin account submits a <code>MsgSetBaseDenoms</code> tx.</p><p>The simplest way to conceptualize how the route is generated is by the following example. Assume we have two base denominations that <code>x/protorev</code> is currently tracking.</p><p>BaseDenoms</p><ul><li>Osmosis</li><li>Atom</li></ul><p>Lets say the <code>postHandler</code> receives a transaction that contains a swap of <strong>Juno</strong> —&gt; <strong>Akash</strong> on pool <strong>4</strong>. In this case, the module will attempt to create three-pool route where a base denomination is on either side of the route. For example, a route that it might create is</p><ul><li>Osmosis —&gt; Akash (on pool 1), Akash —&gt; Juno (on pool 4), Juno —&gt; Osmosis (on pool 2)</li></ul><p>It does so by finding the highest liquidity pool between (Osmosis, Akash) —&gt; pool 1 and the highest liquidity pool between (Osmosis, Juno) —&gt; pool 2. If there is no highest liquidity pool pair between (Osmosis, Juno) or (Osmosis, Akash), no route will be generated.</p><p><strong>NOTE: Cyclic arbitrage routes will always go in the opposite direction of the original swap i.e. in this case we see Juno —&gt; Akash so we know that the route must include a swap of Akash —&gt; Juno.</strong></p><p>The same line of reasoning exists for Atom. <code>x/protorev</code> will attempt to find the highest liquidity pool between (Atom, Akash) and (Atom, Juno). If these pools exist, they will be added to the list of routes that can be simulated later in the pipeline. If not, the route is discarded.</p><p>In both cases, the route that is built will always surround the pool of the original swap that was made. However, we allow for more flexibility in route generation as the highest liquidity method may not be optimal, hence the additional of hot routes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="hot-route-method">Hot Route Method<a class="hash-link" href="#hot-route-method" title="Direct link to heading">​</a></h3><p>Populated through the admin account, the module’s keeper holds a KV store that associates token pairs (for example, osmo/juno) to the routes that result in a high percentage of arbitrage profit on Osmosis (as determined by external analysis).</p><p>The purpose of storing Hot Routes is a recognition that the Highest Liquidity Pool method may not present the best arbitrage routes. As such, hot routes can be configured by the admin account to store additional routes that may be more effective at capturing arbitrage opportunities. Each hot route will store a placeholder for where the current swapped pool will fit into the trade.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="pool-rebalancing">Pool Rebalancing<a class="hash-link" href="#pool-rebalancing" title="Direct link to heading">​</a></h3><p>Now that we have a list of cyclic routes for each pool swapped by the user’s tx, we then determine if any of the routes are profitable. We determine this using a binary search algorithm that finds the amount of the asset to swap in that results in the most of that same asset out. We then calculate profits by taking the difference between the amount of the asset out and amount of the asset in. By iterating through the routes and storing the route, optimal input amount, and profit of the route with the highest profit &gt; 0, we are left with the route and amount to execute the MultiHopSwap against.</p><p>Each swap will generate its own set of routes and <code>x/protorev</code> will execute only the most profitable route.</p><p>The module mints the optimal input amount of the coin to swap in from the <code>bankkeeper</code> to the <code>x/protorev</code> module account, executes the MultiHopSwap by interacting with the <code>x/poolmanager</code> module, burns the optimal input amount of the coin minted to execute the MultiHopSwap, and sends subsequent profits to the module account.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="governance-proposals">Governance Proposals<a class="hash-link" href="#governance-proposals" title="Direct link to heading">​</a></h2><p><code>x/protorev</code> implements two different governance proposals. </p><p><strong>SetProtoRevAdminAccountProposal</strong></p><p>As the landscape of pools on Osmosis evolves, an admin account will be able to add and remove routes for <code>x/protorev</code> to check for cyclic arbitrage opportunities along with several other optimization txs. Largely, the purpose of maintaining hot routes is to reduce the amount of computation that would otherwise be required to determine optimal paths at runtime. </p><p>This proposal is put in place in case the admin account needs to be transferred over. However, as mentioned above, it will be initialized to a trusted address on genesis.</p><p><strong>SetProtoRevEnabledProposal</strong></p><p>This proposal type allows the chain to turn the module on or off. This is meant to be used as a fail safe in the case stakers and the chain decide to turn the module off. This might be used to halt the execution of trades in the case that the <code>x/gamm</code> module has significant upgrades that might produce unexpected behavior from the module.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="posthandler">PostHandler<a class="hash-link" href="#posthandler" title="Direct link to heading">​</a></h2><p>The <code>postHandler</code> extracts pools that were swapped in a transaction and determines if there is a cyclic arbitrage opportunity. If so, the handler will find an optimal route and execute it - rebalancing the pool and returning arbitrage profits to the module account.</p><ol><li>Check if the module is enabled.<ol><li>If the module is disabled, nothing happens.</li></ol></li><li>Extract all pools that were traded on in the transaction (<code>ExtractSwappedPools</code>) as well as the direction of the trade.</li><li>Create cyclic arbitrage routes for each of the swaps above (<code>BuildRoutes</code>)</li><li>For each feasible route, determine if there is a cyclic arbitrage opportunity (<code>IterateRoutes</code>)<ol><li>Determine the optimal amount to swap in and its respective profits via binary search over range of potential input amounts (<code>FindMaxProfitForRoute</code>)</li><li>Compare profits of each route, keep the best route and input amount with the highest profit</li></ol></li><li>If the best route and input amount has a profit &gt; 0, execute the trade (<code>ExecuteTrade</code>) and rebalance the pools on-behalf of the chain through the <code>poolmanagerkeeper</code> (<code>MultiHopSwapExactAmountIn</code>)</li><li>Keep the profits in the module’s account for subsequent distribution.</li></ol><h3 class="anchor anchorWithStickyNavbar_LWe7" id="extractswappedpools">ExtractSwappedPools<a class="hash-link" href="#extractswappedpools" title="Direct link to heading">​</a></h3><p>Checks if there were any swaps made on pools in a transaction, returning the pool ids and input/output denoms for each pool that was traded on.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="buildroutes">BuildRoutes<a class="hash-link" href="#buildroutes" title="Direct link to heading">​</a></h3><p>BuildRoutes takes a token pair (input and output denom) as well as the pool id and returns a list of routes for that token pair that potentially contain a cyclic arbitrage opportunity, populated via the Hot Route and Highest Liquidity Pools method as described above.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="iterateroutes">IterateRoutes<a class="hash-link" href="#iterateroutes" title="Direct link to heading">​</a></h3><p>IterateRoutes iterates through a list of routes, determining the route and input amount that results in the highest cyclic arbitrage profits..</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="findmaxprofitforroute">FindMaxProfitForRoute<a class="hash-link" href="#findmaxprofitforroute" title="Direct link to heading">​</a></h3><p>This will take in a route and determine the optimal amount to swap in to maximize profits, given the reserves of all of the pools that are swapped against in the route. The bounds of the binary search are dynamic and update per route (see <code>UpdateSearchRangeIfNeeded</code>) based on how computationally expensive (in terms of gas) swapping can be on that route. For instance, moving across several ticks on a concentrated pool is relatively expensive, so the bounds of the binary search with a route that includes that pool type may be smaller than a route that does not include that pool type.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="executetrade">ExecuteTrade<a class="hash-link" href="#executetrade" title="Direct link to heading">​</a></h3><p>Execute trade takes the route and optimal input amount as params, mints the optimal amount of input coin, executes the swaps via <code>poolmanagerKeeper</code>’s <code>MultiHopSwapExactAmountIn</code>, and then burns the amount of coins originally minted, storing the profits in it’s own module account.</p><p>This will also update various trading statistics in the module’s store. It will update the total number of trades the module has executed, total profits captured, profits made on this specific route, share of profits the developer account can withdraw, and more.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="execution-guardrails">Execution Guardrails<a class="hash-link" href="#execution-guardrails" title="Direct link to heading">​</a></h2><p><code>x/protorev</code> is bounded and limited in the number of trades the module can execute per block. The purpose of doing so is to ensure that the current block time does not substantially change and that the module does not introduce a new attack vector. </p><p>Execution is currently limited in the following ways</p><ol><li>The binary search method for finding input amounts is bounded by some number of iterations.</li><li>The number of routes that can be traversed in a given transaction is bounded by some number.</li><li>The number of routes that can be traversed in a given block is bounded by some number.</li></ol><h1>Hooks</h1><p>The <code>x/protorev</code> module implements epoch hooks in order to trigger the recalculation of the highest liquidity pools paired with any of the base denominations, manages the distribution of developer profits over time, and updates pool point information.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="epoch-hook">Epoch Hook<a class="hash-link" href="#epoch-hook" title="Direct link to heading">​</a></h2><p>The Epoch hook allows the module to update the information listed above using the epoch identifier <code>day</code>. </p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="highest-liquidity-pools">Highest Liquidity Pools<a class="hash-link" href="#highest-liquidity-pools" title="Direct link to heading">​</a></h3><p>As described above, one method of determining cyclic arbitrage opportunities is to use the highest liquidity pools paired with any base denomination. While this calculation is done on genesis (with only Osmo configured), the pools may restructure over time and new tokens may end up being traded heavily with the base denominations. As such, it is necessary to update this over time so that the module’s logic in determining cyclic arbitrage opportunities is most optimal and updated. Using the <code>AfterEpochEnd</code> hook in combination with the <code>day</code> epoch identifier, we are able to successfully update the pool information every day. At runtime, <code>UpdatePools</code> will be executed and all of the internal pool info will be updated.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="profit-distribution">Profit Distribution<a class="hash-link" href="#profit-distribution" title="Direct link to heading">​</a></h3><p>Profits accumulated by the module will be partially distributed to the developers that built the module in accordance with the governance proposal that was passed: year 1 is 20% of profits, year 2 is 10%, and subsequent years is 5%.</p><p>In order to track how much profit the developers can withdraw at any given moment, the module tracks the number of days since module genesis. This gets incremented in the epoch hook after every day. When a trade gets executed by the module, the module will determine how much of the profit from the trade the developers can receive by using <code>daysSinceModuleGenesis</code> in a simple calculation. </p><p>If the developer account is not set (which it is not on genesis), all funds are held in the module account. Once the developer address is set by the admin account, the developer address will start to automatically receive a share of profits after every trade. The distribution of funds from the module account is done through <code>SendDeveloperFees</code>.</p><h1>Governance Proposals</h1><p>This section defines the governance proposals that result in the state transitions defined on the previous section.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setprotorevadminaccountproposal"><strong><code>SetProtoRevAdminAccountProposal</code></strong><a class="hash-link" href="#setprotorevadminaccountproposal" title="Direct link to heading">​</a></h2><p>A gov <code>content</code> type to set the admin account which will be overseeing the selection of hot routes, developer account, and more. Governance users vote on this proposal and it automatically executes the custom handler for <code>SetProtoRevAdminAccountProposal</code> when the vote passes.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// SetProtoRevAdminAccountProposal is a gov Content type to set the admin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// account that will receive permissions to alter hot routes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> SetProtoRevAdminAccountProposal </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Title       </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,1,opt,name=title,proto3&quot; json:&quot;title,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Description </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,2,opt,name=description,proto3&quot; json:&quot;description,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Account     </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,3,opt,name=account,proto3&quot; json:&quot;account,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The proposal content stateless validation fails if:</p><ul><li>The account entered is not a valid bech32 address.</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="setprotorevenabledproposal"><strong><code>SetProtoRevEnabledProposal</code></strong><a class="hash-link" href="#setprotorevenabledproposal" title="Direct link to heading">​</a></h2><p>A gov <code>content</code> type to enable or disable the <code>x/protorev</code> module. Governance users vote on this proposal and it automatically executes the custom handler for <code>SetProtoRevEnabledProposal</code> when the vote passes.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// SetProtoRevEnabledProposal is a gov Content type to update the proto rev</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// enabled field in the params</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> SetProtoRevEnabledProposal </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Title       </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,1,opt,name=title,proto3&quot; json:&quot;title,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Description </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,2,opt,name=description,proto3&quot; json:&quot;description,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Enabled     </span><span class="token builtin" style="color:rgb(86, 156, 214)">bool</span><span class="token plain">   </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;varint,3,opt,name=enabled,proto3&quot; json:&quot;enabled,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The proposal content stateless validation fails if:</p><ul><li>The entered field to <code>enabled</code> is not a boolean.</li></ul><h1>Transactions</h1><p>This section defines the <code>sdk.Msg</code> concrete types that result in the state transitions defined on the previous section.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="msgsetdeveloperaccount"><code>MsgSetDeveloperAccount</code><a class="hash-link" href="#msgsetdeveloperaccount" title="Direct link to heading">​</a></h2><p>The admin account broadcasts a <code>MsgSetDeveloperAccount</code> to set the developer account.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// MsgSetDeveloperAccount defines the Msg/SetDeveloperAccount request type.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> MsgSetDeveloperAccount </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// admin is the account that is authorized to set the developer account.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Admin </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,1,opt,name=admin,proto3&quot; json:&quot;admin,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// developer_account is the account that will receive a portion of the profit</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// from the protorev module.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    DeveloperAccount </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,2,opt,name=developer_account,json=developerAccount,proto3&quot; json:&quot;developer_account,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Message stateless validation fails if:</p><ul><li>The admin is not a valid bech32 address</li><li>The signature of the user does not match the admin account’s</li><li>The developer account is not a valid bech32 address</li></ul><p>Message stateful validation fails if:</p><ul><li>The admin is not set in state</li><li>The admin entered in the message does not match the admin on chain</li><li>The admin’s signatures are not the same</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="msgsethotroutes"><code>MsgSetHotRoutes</code><a class="hash-link" href="#msgsethotroutes" title="Direct link to heading">​</a></h2><p>The admin account broadcasts a <code>MsgSetHotRoutes</code> to set the hot routes.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// MsgSetHotRoutes defines the Msg/SetHotRoutes request type.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> MsgSetHotRoutes </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// admin is the account that is authorized to set the hot routes.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Admin </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,1,opt,name=admin,proto3&quot; json:&quot;admin,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// hot_routes is the list of hot routes to set.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    HotRoutes </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">TokenPairArbRoutes </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,2,rep,name=hot_routes,json=hotRoutes,proto3&quot; json:&quot;hot_routes,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Message statless validation fails if:</p><ul><li>The admin is not a valid bech32 address</li><li>The signature of the user does not match the admin account’s</li><li>The hot routes are not valid<ul><li>The starting and ending denominations for each route must be the same</li><li>The routes in between must have valid swaps i.e. a → b, b → c, c → a and not a → b, c → b, b → a</li><li>None of the routes can be nil</li><li>The step size must be set for each route  - the step size is used in the binary search method</li><li>There must be at least two hops in each route</li><li>There are duplicate token pairs in the msg</li></ul></li></ul><p>Message stateful validation fails if:</p><ul><li>The admin is not set in state</li><li>The admin entered in the message does not match the admin on chain</li><li>The admin’s signatures are not the same</li><li><code>NewMsgSetHotRoutes</code></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="msgsetmaxpoolpointspertx"><strong><code>MsgSetMaxPoolPointsPerTx</code></strong><a class="hash-link" href="#msgsetmaxpoolpointspertx" title="Direct link to heading">​</a></h2><p>The admin account broadcasts a <strong><code>MsgSetMaxPoolPointsPerTx</code></strong> to set the maximum number of pool points that can consumed per transaction.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// MsgSetMaxPoolPointsPerTx defines the Msg/SetMaxPoolPointsPerTx request type.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> MsgSetMaxPoolPointsPerTx </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// admin is the account that is authorized to set the max pool points per tx.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Admin </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,1,opt,name=admin,proto3&quot; json:&quot;admin,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// max_pool_points_per_tx is the maximum number of pool points that can be</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// consumed per transaction.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    MaxPoolPointsPerTx </span><span class="token builtin" style="color:rgb(86, 156, 214)">uint64</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;varint,2,opt,name=max_pool_points_per_tx,json=maxPoolPointsPerTx,proto3&quot; json:&quot;max_pool_points_per_tx,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Message statless validation fails if:</p><ul><li>The admin is not a valid bech32 address</li><li>The signature of the user does not match the admin account’s</li><li>The MaxPoolPointsPerTx is out of range of the limits we hardcode</li></ul><p>Message stateful validation fails if:</p><ul><li>The admin is not set in state</li><li>The admin entered in the message does not match the admin on chain</li><li>The admin’s signatures are not the same</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="msgsetmaxpoolpointsperblock"><code>MsgSetMaxPoolPointsPerBlock</code><a class="hash-link" href="#msgsetmaxpoolpointsperblock" title="Direct link to heading">​</a></h2><p>The admin account broadcasts a <code>MsgSetMaxPoolPointsPerBlock</code> to set the maximum number of pool points that can consumed per block.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// MsgSetMaxPoolPointsPerBlock defines the Msg/SetMaxPoolPointsPerBlock request</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// type.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> MsgSetMaxPoolPointsPerBlock </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// admin is the account that is authorized to set the max pool points per</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// block.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Admin </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,1,opt,name=admin,proto3&quot; json:&quot;admin,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// max_pool_points_per_block is the maximum number of pool points that can be</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// consumed per block.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    MaxPoolPointsPerBlock </span><span class="token builtin" style="color:rgb(86, 156, 214)">uint64</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;varint,2,opt,name=max_pool_points_per_block,json=maxPoolPointsPerBlock,proto3&quot; json:&quot;max_pool_points_per_block,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Message statless validation fails if:</p><ul><li>The admin is not a valid bech32 address</li><li>The signature of the user does not match the admin account’s</li><li>The MaxRoutesPerBlock is out of range of the limits we hardcode</li></ul><p>Message stateful validation fails if:</p><ul><li>The admin is not set in state</li><li>The admin entered in the message does not match the admin on chain</li><li>The admin’s signatures are not the same</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="msgsetpoolweights"><strong><code>MsgSetPoolWeights</code></strong><a class="hash-link" href="#msgsetpoolweights" title="Direct link to heading">​</a></h2><p>The admin account broadcasts a <strong><code>MsgSetPoolWeights</code></strong> to set the pool weights. The pool weights roughly correspond to the execution time of a swap on that pool type (stable, balancer, concentrated).</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// MsgSetPoolWeights defines the Msg/SetPoolWeights request type.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> MsgSetPoolWeights </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// admin is the account that is authorized to set the pool weights.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Admin </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,1,opt,name=admin,proto3&quot; json:&quot;admin,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// pool_weights is the list of pool weights to set.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    PoolWeights </span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">PoolWeights </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,2,opt,name=pool_weights,json=poolWeights,proto3&quot; json:&quot;pool_weights,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// PoolWeights contains the weights of all of the different pool types. This</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// distinction is made and necessary because the execution time ranges</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// significantly between the different pool types. Each weight roughly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// corresponds to the amount of time (in ms) it takes to execute a swap on that</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// pool type.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> PoolWeights </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// The weight of a stableswap pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    StableWeight </span><span class="token builtin" style="color:rgb(86, 156, 214)">uint64</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;varint,1,opt,name=stable_weight,json=stableWeight,proto3&quot; json:&quot;stable_weight,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// The weight of a balancer pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    BalancerWeight </span><span class="token builtin" style="color:rgb(86, 156, 214)">uint64</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;varint,2,opt,name=balancer_weight,json=balancerWeight,proto3&quot; json:&quot;balancer_weight,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// The weight of a concentrated pool</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    ConcentratedWeight </span><span class="token builtin" style="color:rgb(86, 156, 214)">uint64</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;varint,3,opt,name=concentrated_weight,json=concentratedWeight,proto3&quot; json:&quot;concentrated_weight,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Message statless validation fails if:</p><ul><li>The admin is not a valid bech32 address</li><li>The signature of the user does not match the admin account’s</li><li>Any of the pool weights is not set or is less than or equal to 0.</li></ul><p>Message stateful validation fails if:</p><ul><li>The admin is not set in state</li><li>The admin entered in the message does not match the admin on chain</li><li>The admin’s signatures are not the same</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="msgsetbasedenoms"><strong><code>MsgSetBaseDenoms</code></strong><a class="hash-link" href="#msgsetbasedenoms" title="Direct link to heading">​</a></h2><p>The admin account broadcasts a <strong><code>MsgSetBaseDenoms</code></strong> to set the base denominations the module will use to create cyclic arbitrage routes.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// MsgSetBaseDenoms defines the Msg/SetBaseDenoms request type.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> MsgSetBaseDenoms </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// admin is the account that is authorized to set the base denoms.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Admin </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,1,opt,name=admin,proto3&quot; json:&quot;admin,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// base_denoms is the list of base denoms to set.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    BaseDenoms </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token operator" style="color:rgb(212, 212, 212)">*</span><span class="token plain">BaseDenom </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,2,rep,name=base_denoms,json=baseDenoms,proto3&quot; json:&quot;base_denoms,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// BaseDenom represents a single base denom that the module uses for its</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// arbitrage trades. It contains the denom name alongside the step size of the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">// binary search that is used to find the optimal swap amount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> BaseDenom </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// The denom i.e. name of the base denom (ex. uosmo)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Denom </span><span class="token builtin" style="color:rgb(86, 156, 214)">string</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,1,opt,name=denom,proto3&quot; json:&quot;denom,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// The step size of the binary search that is used to find the optimal swap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// amount</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    StepSize github_com_cosmos_cosmos_sdk_types</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">Int </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;bytes,2,opt,name=step_size,json=stepSize,proto3,customtype=github.com/cosmos/cosmos-sdk/types.Int&quot; json:&quot;step_size&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Message statless validation fails if:</p><ul><li>The admin is not a valid bech32 address</li><li>The signature of the user does not match the admin account’s</li><li>Osmosis is not the first base denom in the list</li><li>The step size for any of the base denoms is not set</li><li>There are duplicate base denoms</li></ul><p>Message stateful validation fails if:</p><ul><li>The admin is not set in state</li><li>The admin entered in the message does not match the admin on chain</li><li>The admin’s signatures are not the same</li></ul><h1>Parameters</h1><p>Tracks whether the module is enabled on genesis.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">// Params defines the parameters for the module.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">type</span><span class="token plain"> Params </span><span class="token keyword" style="color:rgb(86, 156, 214)">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)">// Boolean whether the module is going to be enabled</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Enabled </span><span class="token builtin" style="color:rgb(86, 156, 214)">bool</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">`protobuf:&quot;varint,1,opt,name=enabled,proto3&quot; json:&quot;enabled,omitempty&quot;`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabled">Enabled<a class="hash-link" href="#enabled" title="Direct link to heading">​</a></h2><p>The <code>Enabled</code> parameters toggles all state transitions in the module. When the parameter is disabled, it will prevent all module functionality. </p><h1>Clients</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cli">CLI<a class="hash-link" href="#cli" title="Direct link to heading">​</a></h2><p>Find below a lost of <code>osmosisd</code> commands added with the <code>x/protorev</code> module. A CLI command can look like this:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">osmosisd query protorev params</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="queries">Queries<a class="hash-link" href="#queries" title="Direct link to heading">​</a></h3><table><thead><tr><th>Command</th><th>Subcommand</th><th>Description</th></tr></thead><tbody><tr><td>query protorev</td><td>params</td><td>Queries the parameters of the module</td></tr><tr><td>query protorev</td><td>number-of-trades</td><td>Queries the number of cyclic arbitrage trades ProtoRev has executed</td></tr><tr><td>query protorev</td><td>profits-by-denom <!-- -->[denom]</td><td>Queries ProtoRev profits by denom</td></tr><tr><td>query protorev</td><td>all-profits</td><td>Queries all ProtoRev profits</td></tr><tr><td>query protorev</td><td>statistics-by-route <!-- -->[route]<!-- --> where route is the list of pool ids i.e. <!-- -->[1,2,3]</td><td>Queries ProtoRev statistics by route</td></tr><tr><td>query protorev</td><td>all-statistics</td><td>Queries all ProtoRev statistics</td></tr><tr><td>query protorev</td><td>hot-routes</td><td>Queries the ProtoRev token pair arb routes</td></tr><tr><td>query protorev</td><td>admin-account</td><td>Queries the ProtoRev admin account</td></tr><tr><td>query protorev</td><td>developer-account</td><td>Queries the ProtoRev developer account</td></tr><tr><td>query protorev</td><td>max-pool-points-per-tx</td><td>Queries the ProtoRev max pool points per transaction</td></tr><tr><td>query protorev</td><td>max-pool-points-per-block</td><td>Queries the ProtoRev max pool points per block</td></tr><tr><td>query protorev</td><td>base-denoms</td><td>Queries the ProtoRev base denoms used to create cyclic arbitrage routes</td></tr><tr><td>query protorev</td><td>enabled</td><td>Queries whether the ProtoRev module is currently enabled</td></tr><tr><td>query protorev</td><td>pool-weights</td><td>Queries the pool weights used to determine how computationally expensive a route is</td></tr><tr><td>query protorev</td><td>pool</td><td>Queries the pool id for a given denom pair stored in ProtoRev</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="proposals">Proposals<a class="hash-link" href="#proposals" title="Direct link to heading">​</a></h3><table><thead><tr><th>Command</th><th>Subcommand</th><th>Description</th></tr></thead><tbody><tr><td>tx protorev</td><td>set-pool-weights <!-- -->[path/to/file.json]</td><td>Submit a tx to set the pool weights for ProtoRev</td></tr><tr><td>tx protorev</td><td>set-hot-routes <!-- -->[path/to/file.json]</td><td>Submit a tx to set the hot routes for ProtoRev</td></tr><tr><td>tx protorev</td><td>set-base-denoms <!-- -->[path/to/file.json]</td><td>Submit a tx to set the base denoms for ProtoRev</td></tr><tr><td>tx protorev</td><td>set-max-pool-points-per-block <!-- -->[uint64]</td><td>Submit a tx to set the max pool points per block for ProtoRev</td></tr><tr><td>tx protorev</td><td>set-max-pool-points-per-tx <!-- -->[uint64]</td><td>Submit a tx to set the max pool points per transaction for ProtoRev</td></tr><tr><td>tx protorev</td><td>set-developer-account <!-- -->[sdk.AccAddress]</td><td>Submit a tx to set the developer account for ProtoRev</td></tr><tr><td>tx protorev</td><td>set-admin-account-proposal <!-- -->[sdk.AccAddress]</td><td>Submit a proposal to set the admin account for ProtoRev</td></tr><tr><td>tx protorev</td><td>set-enabled-proposal <!-- -->[boolean]</td><td>Submit a proposal to disable/enable the ProtoRev module</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="grpc--rest">gRPC &amp; REST<a class="hash-link" href="#grpc--rest" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="queries-1">Queries<a class="hash-link" href="#queries-1" title="Direct link to heading">​</a></h3><table><thead><tr><th>Verb</th><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>gRPC</td><td>osmosis.protorev.Query/Params</td><td>Queries the parameters of the module</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevNumberOfTrades</td><td>Queries the number of arbitrage trades the module has executed</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevProfitsByDenom</td><td>Queries the profits of the module by denom</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevAllProfits</td><td>Queries all of the profits from the module</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevStatisticsByRoute</td><td>Queries the number of arbitrages and profits that have been executed for a given route</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevAllStatistics</td><td>Queries all of routes that the module has arbitrage against and the number of trades and profits that have been executed for each route</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevTokenPairArbRoutes</td><td>Queries all of the hot routes that the module is currently arbitraging</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevMaxPoolPointsPerTx</td><td>Queries the ProtoRev max pool points per transaction</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevMaxPoolPointsPerBlock</td><td>Queries the ProtoRev max pool points per block</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevAdminAccount</td><td>Queries the admin account of the ProtoRev</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevDeveloperAccount</td><td>Queries the developer account of the ProtoRev</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevBaseDenoms</td><td>Queries the ProtoRev base denoms used to create cyclic arbitrage routes</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevEnabled</td><td>Queries whether the ProtoRev module is currently enabled</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevPoolWeights</td><td>Queries the number of pool points each pool type will consume when executing and simulating trades</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Query/GetProtoRevPool</td><td>Queries the pool id for a given denom pair stored in ProtoRev</td></tr><tr><td>GET</td><td>/osmosis/protorev/params</td><td>Queries the parameters of the module</td></tr><tr><td>GET</td><td>/osmosis/protorev/number_of_trades</td><td>Queries the number of arbitrage trades the module has executed</td></tr><tr><td>GET</td><td>/osmosis/protorev/profits_by_denom</td><td>Queries the profits of the module by denom</td></tr><tr><td>GET</td><td>/osmosis/protorev/all_profits</td><td>Queries all of the profits from the module</td></tr><tr><td>GET</td><td>/osmosis/protorev/statistics_by_route</td><td>Queries the number of arbitrages and profits that have happened for a given route</td></tr><tr><td>GET</td><td>/osmosis/protorev/all_route_statistics</td><td>Queries all of routes that the module has arbitrage against and the number of trades and profits that have happened for each route</td></tr><tr><td>GET</td><td>/osmosis/protorev/token_pair_arb_routes</td><td>Queries all of the hot routes that the module is currently arbitraging</td></tr><tr><td>GET</td><td>/osmosis/protorev/max_pool_points_per_tx</td><td>Queries the maximum number of pool points that can be consumed per transaction</td></tr><tr><td>GET</td><td>/osmosis/protorev/max_pool_points_per_block</td><td>Queries the maximum number of pool points that can be consumed per block</td></tr><tr><td>GET</td><td>/osmosis/protorev/admin_account</td><td>Queries the admin account of the ProtoRev</td></tr><tr><td>GET</td><td>/osmosis/protorev/developer_account</td><td>Queries the developer account of the ProtoRev</td></tr><tr><td>GET</td><td>/osmosis/protorev/base_denoms</td><td>Queries the base denominations ProtoRev is currently using to create cyclic arbitrage routes</td></tr><tr><td>GET</td><td>/osmosis/protorev/enabled</td><td>Queries whether the ProtoRev module is currently enabled</td></tr><tr><td>GET</td><td>/osmosis/protorev/pool_weights</td><td>Queries the number of pool points each pool type will consume when executing and simulating trades</td></tr><tr><td>GET</td><td>/osmosis/protorev/pool</td><td>Queries the pool id for a given denom pair stored in ProtoRev</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="transactions-1">Transactions<a class="hash-link" href="#transactions-1" title="Direct link to heading">​</a></h3><table><thead><tr><th>Verb</th><th>Method</th><th>Description</th></tr></thead><tbody><tr><td>gRPC</td><td>osmosis.protorev.Msg/SetHotRoutes</td><td>Sets the hot routes that will be explored when creating cyclic arbitrage routes. Can only be called by the admin account</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Msg/SetDeveloperAccount</td><td>Sets the account that can withdraw a portion of the profit from the ProtoRev module. Can only be called by the admin account</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Msg/SetMaxPoolPointsPerTx</td><td>Sets the maximum number of pool points that can be consumed per transaction</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Msg/SetMaxPoolPointsPerBlock</td><td>Sets the maximum number of routes that can be iterated per block</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Msg/SetBaseDenoms</td><td>Sets the base denominations the ProtoRev module will use to create cyclic arbitrage routes</td></tr><tr><td>gRPC</td><td>osmosis.protorev.Msg/SetPoolWeights</td><td>Sets the amount of pool points each pool type will consume when executing and simulating trades</td></tr><tr><td>POST</td><td>/osmosis/protorev/set_hot_routes</td><td>Sets the hot routes that will be explored when creating cyclic arbitrage routes. Can only be called by the admin account</td></tr><tr><td>POST</td><td>/osmosis/protorev/set_developer_account</td><td>Sets the account that can withdraw a portion of the profit from the ProtoRev module. Can only be called by the admin account</td></tr><tr><td>POST</td><td>/osmosis/protorev/set_max_pool_points_per_tx</td><td>Sets the maximum number of pool points that can be consumed per transaction</td></tr><tr><td>POST</td><td>/osmosis/protorev/set_max_pool_points_per_block</td><td>Sets the maximum number of pool points that can be consumed per block</td></tr><tr><td>POST</td><td>/osmosis/protorev/set_pool_weights</td><td>Sets the amount of pool points each pool type will consume when executing and simulating trades</td></tr><tr><td>POST</td><td>/osmosis/protorev/set_base_denoms</td><td>Sets the base denominations that will be used by ProtoRev to construct cyclic arbitrage routes</td></tr></tbody></table><h2 class="anchor anchorWithStickyNavbar_LWe7" id="events">Events<a class="hash-link" href="#events" title="Direct link to heading">​</a></h2><p>There is 1 type of event that exists in ProtoRev:</p><ul><li><code>types.TypeEvtBackrun</code> - &quot;protorev_backrun&quot;</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="typestypeevtbackrun"><code>types.TypeEvtBackrun</code><a class="hash-link" href="#typestypeevtbackrun" title="Direct link to heading">​</a></h3><p>This event is emitted after ProtoRev successfully backruns a transaction.</p><p>It consists of the following attributes:</p><ul><li><code>types.AttributeValueCategory</code> - &quot;ModuleName&quot;<ul><li>The value is the module&#x27;s name - &quot;protorev&quot;.</li></ul></li><li><code>types.AttributeKeyUserPoolId</code><ul><li>The value is the pool id that the user swapped on that ProtoRev backran.</li></ul></li><li><code>types.AttributeKeyTxHash</code><ul><li>The value is the transaction hash that ProtoRev backran.</li></ul></li><li><code>types.AttributeKeyUserDenomIn</code><ul><li>The value is the user denom in for the swap ProtoRev backran.</li></ul></li><li><code>types.AttributeKeyUserDenomOut</code><ul><li>The value is the user denom out for the swap ProtoRev backran.</li></ul></li><li><code>types.AttributeKeyBlockPoolPointsRemaining</code><ul><li>The value is the remaining block pool points ProtoRev can still use after the backrun.</li></ul></li><li><code>types.AttributeKeyTxPoolPointsRemaining</code><ul><li>The value is the remaining tx pool points ProtoRev can still use after the backrun.</li></ul></li><li><code>types.AttributeKeyProtorevProfit</code><ul><li>The value is the profit ProtoRev captured through the backrun.</li></ul></li><li><code>types.AttributeKeyProtorevAmountIn</code><ul><li>The value is the amount Protorev swapped in to execute the backrun.</li></ul></li><li><code>types.AttributeKeyProtorevAmountOut</code><ul><li>The value is the amount Protorev got out of the backrun swap.</li></ul></li><li><code>types.AttributeKeyProtorevArbDenom</code><ul><li>The value is the denom that ProtoRev swapped in/out to execute the backrun.</li></ul></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/osmosis-labs/docs/tree/main/docs/overview/features/protorev.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/overview/features/tokenfactory"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Token Factory</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#cyclic-arbitrage" class="table-of-contents__link toc-highlight">Cyclic Arbitrage</a></li><li><a href="#cyclic-arbitrage-route" class="table-of-contents__link toc-highlight">Cyclic Arbitrage Route</a></li><li><a href="#optimal-amount-in-to-swap" class="table-of-contents__link toc-highlight">Optimal Amount In to Swap</a></li><li><a href="#state-object" class="table-of-contents__link toc-highlight">State Object</a><ul><li><a href="#tokenpairarbroutes" class="table-of-contents__link toc-highlight">TokenPairArbRoutes</a></li><li><a href="#denompairtopool" class="table-of-contents__link toc-highlight">DenomPairToPool</a></li><li><a href="#basedenoms" class="table-of-contents__link toc-highlight">BaseDenoms</a></li><li><a href="#numberoftrades" class="table-of-contents__link toc-highlight">NumberOfTrades</a></li><li><a href="#profitsbydenom" class="table-of-contents__link toc-highlight">ProfitsByDenom</a></li><li><a href="#tradesbyroute--profitsbyroute" class="table-of-contents__link toc-highlight">TradesByRoute &amp; ProfitsByRoute</a></li><li><a href="#protorevenabled" class="table-of-contents__link toc-highlight">ProtoRevEnabled</a></li><li><a href="#adminaccount" class="table-of-contents__link toc-highlight">AdminAccount</a></li><li><a href="#developeraccount" class="table-of-contents__link toc-highlight">DeveloperAccount</a></li><li><a href="#dayssincemodulegenesis" class="table-of-contents__link toc-highlight">DaysSinceModuleGenesis</a></li><li><a href="#developerfees-deprecated-in-v16" class="table-of-contents__link toc-highlight">DeveloperFees (DEPRECATED IN v16)</a></li><li><a href="#maxpoolpointspertx" class="table-of-contents__link toc-highlight">MaxPoolPointsPerTx</a></li><li><a href="#maxpoolpointsperblock" class="table-of-contents__link toc-highlight">MaxPoolPointsPerBlock</a></li><li><a href="#poolpointcountforblock" class="table-of-contents__link toc-highlight">PoolPointCountForBlock</a></li><li><a href="#latestblockheight" class="table-of-contents__link toc-highlight">LatestBlockHeight</a></li><li><a href="#poolweights" class="table-of-contents__link toc-highlight">PoolWeights</a></li><li><a href="#genesisstate" class="table-of-contents__link toc-highlight">GenesisState</a></li></ul></li><li><a href="#route-generation" class="table-of-contents__link toc-highlight">Route Generation</a><ul><li><a href="#highest-liquidity-pool-method" class="table-of-contents__link toc-highlight">Highest Liquidity Pool Method</a></li><li><a href="#hot-route-method" class="table-of-contents__link toc-highlight">Hot Route Method</a></li><li><a href="#pool-rebalancing" class="table-of-contents__link toc-highlight">Pool Rebalancing</a></li></ul></li><li><a href="#governance-proposals" class="table-of-contents__link toc-highlight">Governance Proposals</a></li><li><a href="#posthandler" class="table-of-contents__link toc-highlight">PostHandler</a><ul><li><a href="#extractswappedpools" class="table-of-contents__link toc-highlight">ExtractSwappedPools</a></li><li><a href="#buildroutes" class="table-of-contents__link toc-highlight">BuildRoutes</a></li><li><a href="#iterateroutes" class="table-of-contents__link toc-highlight">IterateRoutes</a></li><li><a href="#findmaxprofitforroute" class="table-of-contents__link toc-highlight">FindMaxProfitForRoute</a></li><li><a href="#executetrade" class="table-of-contents__link toc-highlight">ExecuteTrade</a></li></ul></li><li><a href="#execution-guardrails" class="table-of-contents__link toc-highlight">Execution Guardrails</a></li><li><a href="#epoch-hook" class="table-of-contents__link toc-highlight">Epoch Hook</a><ul><li><a href="#highest-liquidity-pools" class="table-of-contents__link toc-highlight">Highest Liquidity Pools</a></li><li><a href="#profit-distribution" class="table-of-contents__link toc-highlight">Profit Distribution</a></li></ul></li><li><a href="#setprotorevadminaccountproposal" class="table-of-contents__link toc-highlight"><strong><code>SetProtoRevAdminAccountProposal</code></strong></a></li><li><a href="#setprotorevenabledproposal" class="table-of-contents__link toc-highlight"><strong><code>SetProtoRevEnabledProposal</code></strong></a></li><li><a href="#msgsetdeveloperaccount" class="table-of-contents__link toc-highlight"><code>MsgSetDeveloperAccount</code></a></li><li><a href="#msgsethotroutes" class="table-of-contents__link toc-highlight"><code>MsgSetHotRoutes</code></a></li><li><a href="#msgsetmaxpoolpointspertx" class="table-of-contents__link toc-highlight"><strong><code>MsgSetMaxPoolPointsPerTx</code></strong></a></li><li><a href="#msgsetmaxpoolpointsperblock" class="table-of-contents__link toc-highlight"><code>MsgSetMaxPoolPointsPerBlock</code></a></li><li><a href="#msgsetpoolweights" class="table-of-contents__link toc-highlight"><strong><code>MsgSetPoolWeights</code></strong></a></li><li><a href="#msgsetbasedenoms" class="table-of-contents__link toc-highlight"><strong><code>MsgSetBaseDenoms</code></strong></a></li><li><a href="#enabled" class="table-of-contents__link toc-highlight">Enabled</a></li><li><a href="#cli" class="table-of-contents__link toc-highlight">CLI</a><ul><li><a href="#queries" class="table-of-contents__link toc-highlight">Queries</a></li><li><a href="#proposals" class="table-of-contents__link toc-highlight">Proposals</a></li></ul></li><li><a href="#grpc--rest" class="table-of-contents__link toc-highlight">gRPC &amp; REST</a><ul><li><a href="#queries-1" class="table-of-contents__link toc-highlight">Queries</a></li><li><a href="#transactions-1" class="table-of-contents__link toc-highlight">Transactions</a></li></ul></li><li><a href="#events" class="table-of-contents__link toc-highlight">Events</a><ul><li><a href="#typestypeevtbackrun" class="table-of-contents__link toc-highlight"><code>types.TypeEvtBackrun</code></a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="margin-bottom--sm"><a class="footerLogoLink_DDai" href="/"><img src="/logo/light.svg" alt="Osmosis Docs" class="themedImage_ToTc themedImage--light_HNdA footer__logo" height="36px"><img src="/logo/dark.svg" alt="Osmosis Docs" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" height="36px"></a></div><div class="footer__row"><div class="footer__data"><div class="footer__cta"></div></div><div class="links"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.osmosis.zone" target="_blank" rel="noopener noreferrer" class="footer__link-item">Launch App</a></li><li class="footer__item"><a href="https://docs.osmosis.zone" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Portal</a></li><li class="footer__item"><a href="https://osmosis.zone/ecosystem" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ecosystem</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.osmosis.zone" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation</a></li><li class="footer__item"><a href="https://medium.com/@Osmosis" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium</a></li><li class="footer__item"><a href="https://commonwealth.im/osmosis/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community</a></li></ul></div></div></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © Osmosis Labs since 2023. All rights reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.925a436b.js"></script>
<script src="/assets/js/main.c0207744.js"></script>
</body>
</html>