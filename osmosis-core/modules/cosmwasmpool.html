<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-osmosis-core docs-doc-id-modules/cosmwasmpool/README">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">CosmWasm Pool | Osmosis Docs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.osmosis.zone/img/osmosis-docs-card.png"><meta data-rh="true" name="twitter:image" content="https://docs.osmosis.zone/img/osmosis-docs-card.png"><meta data-rh="true" property="og:url" content="https://docs.osmosis.zone/osmosis-core/modules/cosmwasmpool"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-osmosis-core-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-osmosis-core-current"><meta data-rh="true" property="og:title" content="CosmWasm Pool | Osmosis Docs"><meta data-rh="true" name="description" content="Overview"><meta data-rh="true" property="og:description" content="Overview"><link data-rh="true" rel="icon" href="/favicon.png"><link data-rh="true" rel="canonical" href="https://docs.osmosis.zone/osmosis-core/modules/cosmwasmpool"><link data-rh="true" rel="alternate" href="https://docs.osmosis.zone/osmosis-core/modules/cosmwasmpool" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.osmosis.zone/osmosis-core/modules/cosmwasmpool" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://2CBDVP21VK-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="Osmosis Docs" href="/opensearch.xml">










<link rel="preconnect" href="https://app.posthog.com">
<script>!function(t,e){var o,p,i,n;e.__SV||(window.posthog=e,e._i=[],e.init=function(r,s,a){function c(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(i=t.createElement("script")).type="text/javascript",i.async=!0,i.src=s.api_host+"/static/array.js",(n=t.getElementsByTagName("script")[0]).parentNode.insertBefore(i,n);var g=e;for(void 0!==a?g=e[a]=[]:a="posthog",g.people=g.people||[],g.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},g.people.toString=function(){return g.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset".split(" "),p=0;p<o.length;p++)c(g,o[p]);e._i.push([r,s,a])},e.__SV=1)}(document,window.posthog||[]),posthog.init("00",{api_host:"https://app.posthog.com"})</script>

<script src="https://tally.so/widgets/embed.js"></script>
<script src="https://widget.kapa.ai/kapa-widget.bundle.js" data-website-id="c5b5e9fc-d025-4c12-b08e-9784d0e2161f" data-project-name="Osmosis" data-project-color="#7900B4" data-project-logo="https://app.osmosis.zone/tokens/osmo.svg" async></script><link rel="stylesheet" href="/assets/css/styles.792232e5.css">
<link rel="preload" href="/assets/js/runtime~main.b0431ac5.js" as="script">
<link rel="preload" href="/assets/js/main.853f4916.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"dark")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/logo/light.svg" alt="Osmosis Docs" class="themedImage_ToTc themedImage--light_HNdA" height="26px" width="114px"><img src="/logo/dark.svg" alt="Osmosis Docs" class="themedImage_ToTc themedImage--dark_i4oU" height="26px" width="114px"></div></a><a class="navbar__item navbar__link" href="/overview/educate">Overview</a><a class="navbar__item navbar__link" href="/overview/integrate">Integrate</a><a class="navbar__item navbar__link" href="/overview/validate">Validate &amp; Run your Node</a><a class="navbar__item navbar__link" href="/overview/endpoints">Endpoints</a><a class="navbar__item navbar__link" href="/overview/features">Features</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/osmosis-core">Develop</a><a href="https://github.com/osmosis-labs" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon github-icon"></a><a href="https://discord.com/invite/osmosis" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link pseudo-icon discord-icon"></a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://app.osmosis.zone" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link dev-portal-signup dev-portal-link">Launch Dex<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_mhZE"><div class="multiSectionContainer_bYm7"><div class="section_olD1 sectionActive_D9yk" tabindex="0"><div>Osmosis Core</div><div><div class="row_KvCx"><button type="button" role="combobox" aria-controls="" aria-expanded="false" aria-autocomplete="none" aria-label="Select Section" class="sections-menu-trigger"><span style="pointer-events:none"></span><span aria-hidden="true"><svg width="15" height="15" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg" class="sections-menu-scrollButton"><path d="M3.13523 6.15803C3.3241 5.95657 3.64052 5.94637 3.84197 6.13523L7.5 9.56464L11.158 6.13523C11.3595 5.94637 11.6759 5.95657 11.8648 6.15803C12.0536 6.35949 12.0434 6.67591 11.842 6.86477L7.84197 10.6148C7.64964 10.7951 7.35036 10.7951 7.15803 10.6148L3.15803 6.86477C2.95657 6.67591 2.94637 6.35949 3.13523 6.15803Z" fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path></svg></span></button><select aria-hidden="true" tabindex="-1" style="position:absolute;border:0;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;word-wrap:normal"></select></div></div></div><div class="section_olD1" tabindex="0"><div>CosmWasm</div><div><p class="description_C5q3">Building and interacting with Smart contracts on Osmosis.</p></div></div><div class="section_olD1" tabindex="0"><div>Frontend &amp; SDKs</div><div><p class="description_C5q3">Libraries &amp; UI components to build on top of Osmosis.</p></div></div></div><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/osmosis-core">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/osmosis-core/build">Build and Test</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/osmosis-core/osmosisd">Osmosis CLI</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/osmosis-core/ide-guide">IDE Setup</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/osmosis-core/category/modules">Modules</a><button aria-label="Toggle the collapsible sidebar category &#x27;Modules&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules">Introduction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/concentrated-liquidity">Concentrated Liquidity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/osmosis-core/modules/cosmwasmpool">CosmWasm Pool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/downtime-detector">Downtime-detector</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/epochs">Epochs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" tabindex="0" href="/osmosis-core/modules/gamm">GAMM</a><button aria-label="Toggle the collapsible sidebar category &#x27;GAMM&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/gov">Gov</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/ibc-hooks">IBC-hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/ibc-rate-limit">IBC Rate Limit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/incentives">Incentives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/lockup">Lockup</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/mint">Mint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/pool-incentives">Pool Incentives</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/pool-manager">Pool Manager Module</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/protorev">Osmosis modules</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/superfluid">Superfluid Staking</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/tokenfactory">Token Factory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/twap">TWAP</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/txfees">Txfees</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/osmosis-core/modules/valpref-module">validator-set Preference</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/osmosis-core/asset-info">Asset Info</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/osmosis-core/category/keys-management">Keys Management</a><button aria-label="Toggle the collapsible sidebar category &#x27;Keys Management&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/osmosis-core/category/relayer">Relayer</a><button aria-label="Toggle the collapsible sidebar category &#x27;Relayer&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/osmosis-core/contributing">Contributing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/osmosis-core/ibc">IBC Protocol</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/osmosis-core/category/guides">Guides</a><button aria-label="Toggle the collapsible sidebar category &#x27;Guides&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>CosmWasm Pool</h1><h2 class="anchor anchorWithStickyNavbar_LWe7" id="overview">Overview<a class="hash-link" href="#overview" title="Direct link to heading">​</a></h2><p>The CosmWasm Pool Module is an extension for the Osmosis pools, aiming to create a custom module that allows users to create and manage liquidity pools backed by CosmWasm smart contracts. The feature enables developers to build and deploy custom smart contracts that can be integrated with the rest of the pool types on the Osmosis chain.</p><p>The module is built on top of the CosmWasm smart contracting platform, which provides a secure and efficient way to develop and execute WebAssembly (Wasm) smart contracts on the Cosmos SDK.</p><p>Having pools in CosmWasm provides several benefits, one of which is avoiding the need for chain upgrades when introducing new functionalities or modifying existing ones related to liquidity pools. This advantage is particularly important in the context of speed of development and iteration.</p><p>An example of a CosmWasm pool type:</p><ul><li><a href="https://github.com/osmosis-labs/transmuter" target="_blank" rel="noopener noreferrer">transmuter</a></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="key-components">Key Components<a class="hash-link" href="#key-components" title="Direct link to heading">​</a></h2><ul><li><strong>Keeper</strong>: The module&#x27;s keeper is responsible for managing the state of the CosmWasm pools, including creating and initializing pools,
querying pool data, and executing privileged operations such as swaps using the CosmWasm sudo message. <ul><li><code>InitializePool</code>: Initializes a new CosmWasm pool by instantiating a Wasm contract and storing the pool model in the keeper.</li><li><code>Swap operations</code>: Swap operations like <code>SwapExactAmountIn</code> and <code>SwapExactAmountOut</code> are implemented, allowing users to perform swaps
within the CosmWasm pools.</li><li><code>Swap estimation</code>: Functions like CalcOutAmtGivenIn, and CalcInAmtGivenOut are provided to calculate prices and amounts for swap operations.</li><li><code>Pool information</code>: Functions like <code>CalculateSpotPrice</code>, <code>GetPool</code>, <code>GetPoolAssets</code>, <code>GetPoolBalances</code>, <code>GetPoolTotalShares</code> allow
for querying the state of the CosmWasm pools.</li></ul></li></ul><ul><li><p><strong>Query and Sudo functions</strong>: The module includes generic functions to query CosmWasm smart contracts and execute sudo messages.
The Query and Sudo functions are used to interact with the smart contracts, while MustQuery and MustSudo variants panic if an error
occurs during the query or sudo call, respectively.</p></li><li><p><strong><code>poolmanager.PoolI</code> Interface</strong>: The CosmWasm Pool Model implements the PoolI interface from the Pool Manager Module to enable
the creation and management of liquidity pools backed by CosmWasm smart contracts. By implementing the PoolI interface, the model
ensures compatibility with the existing Pool Manager Module&#x27;s structure and functionalities and integrates seamlessly with
other modules such as <code>x/concentrated-liquidity</code> and <code>x/gamm</code>.</p></li><li><p><strong><code>poolmanager.PoolModule</code> Interface</strong>: To integrate the CosmWasm Pool Module with the existing Pool Manager Module,
the module&#x27;s keeper has to implement the PoolModule interface from <code>x/poolmanager</code> Module. By implementing the PoolModule interface,
the CosmWasm Pool Keeper can register itself as an extension to the existing Pool Manager Module and handle the creation and management
of CosmWasm-backed liquidity pools as well as receive swaps propagated from the <code>x/poolmanager</code>.</p></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="creating-new-cosmwasm-pool">Creating new CosmWasm Pool<a class="hash-link" href="#creating-new-cosmwasm-pool" title="Direct link to heading">​</a></h2><p>To create new CosmWasm Pool, there are 3 modules involved: <code>x/cosmwasmpool</code>, <code>x/wasm</code>, and <code>x/poolmanager</code>. Here is an overview of the process:</p><div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">graph TD;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Sender((Sender))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Sender -- create poool --&gt; x/cosmwasmpool</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  x/cosmwasmpool -- get next &amp; set pool id --&gt; x/poolmanager</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  x/cosmwasmpool -- instantiate contract --&gt; x/wasm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The CosmWasm contract that is to be instanitiated needs to implement <a href="#cosmwasm-pool-contract-interface">CosmWasm Pool Contract Interface</a> and store it on chain first. Then new pool can be created by sending <code>MsgCreateCosmWasmPool</code>.</p><p><code>MsgCreateCosmWasmPool</code> contains <code>InstantiateMsg</code>, which is a message that will be passed to the CosmWasm contract when it is instantiated. The structure of the message is defined by the contract developer, and can contain any information that the contract needs to be instantiated. JSON format is used for <code>InstantiateMsg</code>.</p><div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">sequenceDiagram</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    participant Sender</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    participant x/cosmwasmpool</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    participant x/poolmanager</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    participant x/wasm</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Sender -&gt;&gt; x/cosmwasmpool: MsgCreateCosmWasmPool {CodeId, InstantiateMsg, Sender}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Note over x/wasm: Given there is a pool contract with CodeId</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    x/poolmanager -&gt;&gt; x/cosmwasmpool: Call GetNextPoolId()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    x/cosmwasmpool -&gt;&gt; x/poolmanager: Call SetNextPoolId(poolId)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    x/cosmwasmpool -&gt;&gt; x/wasm: Call InstantiateContract(CodeId, InstantiateMsg)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    x/wasm --&gt;&gt; x/cosmwasmpool: ContractAddress</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Note over x/cosmwasmpool: Store CodeId, ContractAddress, and PoolId</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    x/cosmwasmpool --&gt;&gt;  Sender: MsgCreateCosmWasmPoolResponse {PoolId}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="providing--withdrawing-liquidity">Providing / Withdrawing Liquidity<a class="hash-link" href="#providing--withdrawing-liquidity" title="Direct link to heading">​</a></h2><p>Currently, all existing pool types have their own way of providing liquidity and shares calculation. CosmWasm pool aims to be flexible that regards and let the contract define the way of providing liquidity. So there is no restriction here, and the contract developer can define the way of providing liquidity as they wish, potentially with execute endpoint since <code>MsgExecuteContract</code> triggers state mutating endpoint and can also attach funds to it.</p><p>Common interface and later be defined for the contract to implement as spec and/or create a separated create for that purpose.</p><p>It&#x27;s important to note that the <em><strong>contract itself hold tokens that are provided by users</strong></em>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="swap">Swap<a class="hash-link" href="#swap" title="Direct link to heading">​</a></h2><p>One of the main reason why CosmWasm pool is implemented as a module + contract rather than a contract only is that it allows us to use the existing pool manager module to handle swap, which means things like swap routing, cross chain swap, and other functionality that depends on existing pool interface works out of the box.</p><div class="language-mermaid codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-mermaid codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">graph TD;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Sender((Sender))</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  Sender -- swap --&gt; x/poolmanager</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  x/poolmanager -- route msg to --&gt; x/cosmwasmpool</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  x/cosmwasmpool -- sudo execute contract --&gt; x/wasm</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  x/wasm -- sudo --&gt; wasm/pool</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  x/cosmwasmpool -- send token_in from sender to wasm/pool --&gt; x/bank</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  wasm/pool -- send token_out to sender --&gt; x/bank</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Pool contract&#x27;s sudo endpoint expect the following message variant:</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// SwapExactAmountIn swaps an exact amount of tokens in for as many tokens out as possible.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// The amount of tokens out is determined by the current exchange rate and the swap fee.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// The user specifies a minimum amount of tokens out, and the transaction will revert if that amount of tokens</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// is not received.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SwapExactAmountIn {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    sender: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    token_in: Coin,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    token_out_denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    token_out_min_amount: Uint128,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    swap_fee: Decimal,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">},</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// SwapExactAmountOut swaps as many tokens in as possible for an exact amount of tokens out.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// The amount of tokens in is determined by the current exchange rate and the swap fee.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// The user specifies a maximum amount of tokens in, and the transaction will revert if that amount of tokens</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/// is exceeded.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">SwapExactAmountOut {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    sender: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    token_in_denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    token_in_max_amount: Uint128,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    token_out: Coin,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    swap_fee: Decimal,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">},</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The reason why this needs to be sudo endpoint, which can only be called by the chain itself, is that the chain can provide correct information about <code>swap_fee</code>, which can be deviated from contract defined <code>swap_fee</code> in multihop scenario.</p><p><code>swap_fee</code> in this context is intended to be fee that is collected by liquidity providers. If the contract provider wants to collect fee for itself, it should implement its own fee collection mechanism.</p><p>And because sudo message can&#x27;t attach funds like execute message, chain-side is required to perform sending token to the contract and ensure that <code>token_in</code> and <code>token_in_max_amount</code> is exactly the same amount of token that gets sent to the contract.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="deactivating">Deactivating<a class="hash-link" href="#deactivating" title="Direct link to heading">​</a></h2><p>On contract&#x27;s sudo endpoint, <code>SetActive</code> can be called to deactivate the pool. This will prevent the pool from being used for swap, and also prevent users from providing liquidity to the pool. Contract needs to check if the pool is active before performing any state mutating operation except <code>SetActive</code>.</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">SetActive {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    is_active: bool,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>(TBD) On how to handle the deactivation operationally.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="cosmwasm-pool-contract-interface">CosmWasm Pool Contract Interface<a class="hash-link" href="#cosmwasm-pool-contract-interface" title="Direct link to heading">​</a></h2><p>The contract interface is defined so that <code>cosmwasmpool</code> can delegate <code>PoolI</code> and <code>PoolModuleI</code> calls to contract.</p><p>The following are the messages that the contract needs to implement. (If you have trouble interpreting this, please read <a href="#rust-deserialization">Rust de/serialization</a>)</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="query">Query<a class="hash-link" href="#query" title="Direct link to heading">​</a></h3><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[derive(QueryResponses)]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">enum QueryMessage {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// GetSwapFee returns the pool&#x27;s swap fee, based on the current state.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// Pools may choose to make their swap fees dependent upon state</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// (prior TWAPs, network downtime, other pool states, etc.)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// This is intended to be fee that is collected by liquidity providers.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// If the contract provider wants to collect fee for itself, it should implement its own fee collection mechanism.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    #[returns(GetSwapFeeResponse)]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    GetSwapFee {},</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// Returns whether the pool has swaps enabled at the moment</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    #[returns(IsActiveResponse)]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    IsActive {},</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// GetTotalShares returns the total number of LP shares in the pool</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// GetTotalPoolLiquidity returns the coins in the pool owned by all LPs</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    #[returns(TotalPoolLiquidityResponse)]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    GetTotalPoolLiquidity {},</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// Returns the spot price of the &#x27;base asset&#x27; in terms of the &#x27;quote asset&#x27; in the pool,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// errors if either baseAssetDenom, or quoteAssetDenom does not exist.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// For example, if this was a UniV2 50-50 pool, with 2 ETH, and 8000 UST</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// pool.SpotPrice(ctx, &quot;eth&quot;, &quot;ust&quot;) = 4000.00</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    #[returns(SpotPriceResponse)]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    SpotPrice {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        quote_asset_denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        base_asset_denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// CalcOutAmtGivenIn calculates the amount of tokenOut given tokenIn and the pool&#x27;s current state.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// Returns error if the given pool is not a CFMM pool. Returns error on internal calculations.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    #[returns(CalcOutAmtGivenInResponse)]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    CalcOutAmtGivenIn {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        token_in: Coin,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        token_out_denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        swap_fee: Decimal,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// CalcInAmtGivenOut calculates the amount of tokenIn given tokenOut and the pool&#x27;s current state.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// Returns error if the given pool is not a CFMM pool. Returns error on internal calculations.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    #[returns(CalcInAmtGivenOutResponse)]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    CalcInAmtGivenOut {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        token_out: Coin,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        token_in_denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        swap_fee: Decimal,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">pub struct GetSwapFeeResponse {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pub swap_fee: Decimal,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">pub struct IsActiveResponse {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pub is_active: bool,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">pub struct TotalPoolLiquidityResponse {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pub total_pool_liquidity: Vec&lt;Coin&gt;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">pub struct SpotPriceResponse {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pub spot_price: Decimal,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">pub struct CalcOutAmtGivenInResponse {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pub token_out: Coin,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">pub struct CalcInAmtGivenOutResponse {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pub token_in: Coin,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="sudo">Sudo<a class="hash-link" href="#sudo" title="Direct link to heading">​</a></h3><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">pub enum SudoMessage {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// SetActive sets the active status of the pool.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    SetActive {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        is_active: bool,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// SwapExactAmountIn swaps an exact amount of tokens in for as many tokens out as possible.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// The amount of tokens out is determined by the current exchange rate and the swap fee.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// The user specifies a minimum amount of tokens out, and the transaction will revert if that amount of tokens</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// is not received.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    SwapExactAmountIn {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        sender: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        token_in: Coin,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        token_out_denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        token_out_min_amount: Uint128,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        swap_fee: Decimal,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// SwapExactAmountOut swaps as many tokens in as possible for an exact amount of tokens out.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// The amount of tokens in is determined by the current exchange rate and the swap fee.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// The user specifies a maximum amount of tokens in, and the transaction will revert if that amount of tokens</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    /// is exceeded.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    SwapExactAmountOut {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        sender: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        token_in_denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        token_in_max_amount: Uint128,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        token_out: Coin,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        swap_fee: Decimal,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="incentives-and-shares">Incentives and Shares<a class="hash-link" href="#incentives-and-shares" title="Direct link to heading">​</a></h2><p>In order to allow CosmWasm pool to work with the incentives module (or being composable in general),
the contract needs to be able to create share tokens.</p><p>We handle this by utilizing the <code>x/tokenfactory</code> module.
Each pool has share denom with this pattern: <code>factory/{contract_address}/cw-pool/{custom-name}</code>.</p><p>The contract address uniquely identifies a pool. We also use cw-pool to make these denoms distinguishable
from other tokenfactory denoms and provide contracts the ability to customize the <code>{custom-name}</code>.</p><p>Each contract is responsible for minting and burning its token factory shares. The chain does no interaction with tokenfactory.</p><p>To integrate <code>x/cosmwasmpool</code> into the <code>x/incentives</code> module, it also needs to create gauges.</p><p>This can be done by setting <code>after_pool_created</code> on <code>instantiate</code> response.</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">Ok(Response::new()</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    .add_attribute(&quot;method&quot;, &quot;instantiate&quot;)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    .add_attribute(&quot;contract_name&quot;, CONTRACT_NAME)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    .add_attribute(&quot;contract_version&quot;, CONTRACT_VERSION)</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // set `after_pool_created` information on response</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // for `cosmwasmpool` module to process</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    .set_data(to_binary(&amp;after_pool_created)?))</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>after_pool_created</code> has type:</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">pub struct AfterPoolCreated {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pub create_pool_guages: Option&lt;CreatePoolGauges&gt;,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">#[cw_serde]</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">pub enum CreatePoolGauges {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // This works exactly like `gamm`&#x27;s.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    DefaultLockableDurations {},</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // Custom gauges can be created.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    Custom { msgs: Vec&lt;MsgCreateGauge&gt; },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h2 class="anchor anchorWithStickyNavbar_LWe7" id="appendix">Appendix<a class="hash-link" href="#appendix" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="twap">TWAP<a class="hash-link" href="#twap" title="Direct link to heading">​</a></h3><p><code>x/twap</code> is not implemented for cosmwasm pools but can be in the future if there is a need.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rust-deserialization">Rust de/serialization<a class="hash-link" href="#rust-deserialization" title="Direct link to heading">​</a></h3><p>Contract read these msg as JSON format. Here are some examples of how it is being de/serialized:</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">// Notice that enum variant is turned into snake case and becomes the key of the JSON object.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">enum QueryMessage {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // { &quot;spot_price&quot;: { &quot;quote_asset_denom&quot;: &quot;denom1&quot;, &quot;base_asset_denom&quot;: &quot;denom2&quot; } }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    SpotPrice {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        quote_asset_denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        base_asset_denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    },</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// In case of struct, the struct name is not used as the key,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">// since there is no need to distinguish between different structs.</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">struct SpotPriceResponse {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    // { &quot;spot_price&quot;: &quot;0.001&quot; }</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pub spot_price: Decimal,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><a href="https://docs.rs/cosmwasm-std/1.2.3/cosmwasm_std/struct.Decimal.html" target="_blank" rel="noopener noreferrer">Decimal</a>  and <a href="https://docs.rs/cosmwasm-std/1.2.3/cosmwasm_std/struct.Uint128.html" target="_blank" rel="noopener noreferrer">Uint128</a> are represented as string in JSON.</p><p><a href="https://docs.rs/cosmwasm-std/1.2.3/cosmwasm_std/struct.Coin.html" target="_blank" rel="noopener noreferrer">Coin</a> is:</p><div class="language-rs codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-rs codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">pub struct Coin {</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pub denom: String,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    pub amount: Uint128,</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="governance-and-code-id-management">Governance and Code Id Management<a class="hash-link" href="#governance-and-code-id-management" title="Direct link to heading">​</a></h3><p>Despite code upload being permissioned by governance on Osmosis, it is allowed to be done by a certain
set of addresses:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">osmosisd q wasm params</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">code_upload_access:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  address: </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  addresses:</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  - osmo1cd4nn8yzdrrsfqsmmvaafq8r03xn38qgqt8fzh</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  - osmo1wl59k23zngj34l7d42y9yltask7rjlnxgccawc7ltrknp6n52fps94qsjd</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  - osmo19vxp8vq8qm368dr026qxh8v82satwaf79y235lfv6wmgpwxx8dtskedaku</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  - osmo1e0x2hnhhwyek7eq3kcxu2x6pt77wdnwz0lutz9fespdr9utq963qr0y5p5</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  - osmo14n3a65fnqz9jve85l23al6m3pjugf0atvrfqh5</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  - osmo15wna5dwylkuzvljsudyn6zfsd4zl0rkg5ge888mzk4vtnjpp0z5q4e9w58</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  - osmo1r02tlyyaqs6tmrfa4jf37t7ewuxr57qp8ghzly</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  permission: AnyOfAddresses</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">instantiate_default_permission: Everybody</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We would like to make sure that it is not possible to upload any pool code
without governance approval. This is why we create two additional governance proposals:</p><p>Note, that in both cases, x/cosmwasmpool module account will act as the admin and creator of the contract.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="1-store-code-and-update-code-id-whitelist">1. Store code and update code id whitelist<a class="hash-link" href="#1-store-code-and-update-code-id-whitelist" title="Direct link to heading">​</a></h4><p>Proposal Name: <code>UploadCosmWasmPoolCodeAndWhiteListProposal</code></p><p>On successful passing of this proposal, the code id of the pool contract will be added to the whitelist.
As a result, anyone would be able to instantiate a pool contract with this code id when creating a pol.
No address will be able to maliciously upload a new code id and instantiate a pool contract with it without
governance approval.</p><p>Inputs</p><ul><li><code>uploadByteCode</code> - <code>[]byte</code> - the raw wasm bytecode</li></ul><p>The created code id is emitted via <code>TypeEvtUploadedCosmwasmPoolCode</code> event.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="2-store-code-and-migrate-a-specific-code-id-to-a-new-code-id">2. Store code and migrate a specific code id to a new code id<a class="hash-link" href="#2-store-code-and-migrate-a-specific-code-id-to-a-new-code-id" title="Direct link to heading">​</a></h4><p>Proposal Name: <code>MigratePoolContractsProposal</code></p><p>Similarly, if we want to migrate a contract, anyone can do so but they will need to go
through a custom governance proposal.</p><p>Migrates all given cw pool contracts specified by their IDs. It has two options to perform the migration.</p><p>a. If the <code>codeID</code> is non-zero, it will migrate the pool contracts to a given <code>codeID</code> assuming that it has already been uploaded. uploadByteCode must be empty in such a case. Fails if <code>codeID</code> does not exist. Fails if uploadByteCode is not empty.</p><p>b. If the <code>codeID</code> is zero, it will upload the given <code>uploadByteCode</code> and use the new resulting code id to migrate the pool to. Errors if uploadByteCode is empty or invalid.</p><p>In both cases, if one of the pools specified by the given <code>poolID</code> does not exist, the proposal fails.</p><p>The reason for having <code>poolID</code>s be a slice of ids is to account for the potential need for emergency migration of all old code ids to new code ids, or simply having the flexibility of migrating multiple older pool contracts to a new one at once when there is a release.</p><p><code>poolD</code>s must be at the most size of <code>PoolMigrationLimit</code> module parameter. It is configured to 20 at launch.
The proposal fails if more. Note that 20 was chosen arbitrarily to have a constant bound on the number of pools migrated at once.</p><p>Inputs</p><ul><li><p><code>poolIDs</code>        - <code>[]uint64</code></p></li><li><p><code>codeID</code>         - <code>uint64</code></p></li><li><p><code>uploadByteCode</code> - <code>[]byte</code></p><p>If the code is uploaded via proposal, the resulting code id is emitted via <code>TypeEvtMigratedCosmwasmPoolCode</code>.</p></li></ul><h5 class="anchor anchorWithStickyNavbar_LWe7" id="analysis-of-the-parameter-choice">Analysis of the Parameter Choice<a class="hash-link" href="#analysis-of-the-parameter-choice" title="Direct link to heading">​</a></h5><ul><li><p>Pros</p><ul><li>The flexibility is maximized as each pool id can be migrated individually either by uploading a new contract code or migrating to a pre-added one.</li><li>There is still an ability to migrate all pools belonging to a list of code ids. The max number of pools migrated at once is bounded by a constant parameter.</li></ul></li><li><p>Cons</p><ul><li>If there are multiple iterations of the same type, It might become cumbersome to keep track of which pool is on which code id, why one is migrated and the other one is not</li><li>Some conditionality with proposal parameters. For example, if <code>codeId</code> is zero, byte code must be empty.</li></ul></li></ul><p>Overall, we concluded that pros outweigh the cons, and this is the best approach out of the other alternatives considered.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="3-whitelist-management-via-params">3. Whitelist Management via Params<a class="hash-link" href="#3-whitelist-management-via-params" title="Direct link to heading">​</a></h4><p>Since the code id whitelist is implemented as a module parameter, in addition to
the previous two proposals, the whitelist can be updated via parameter change proposal
to either add or remove a code id from the whitelist independently of the code upload.</p><p>The relevant parameter for changing is <code>CodeIdWhitelist</code></p><p>Note, that the update to the parameter overwrites all previous values so the proposer
should be careful to include all code ids that should be whitelisted.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="4-pool-migration-limit-via-params">4. Pool Migration Limit via Params<a class="hash-link" href="#4-pool-migration-limit-via-params" title="Direct link to heading">​</a></h4><p>Additionally, the maximum number of pools that can be migrated at once is also implemented
as a parameter. It is initialized to 20 in the v16 upgrade handler. However, governance
can tweak it by changing the <code>PoolMigrationLimit</code> parameter.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/osmosis-labs/docs/tree/main/docs/osmosis-core/modules/cosmwasmpool/README.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/osmosis-core/modules/concentrated-liquidity"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Concentrated Liquidity</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/osmosis-core/modules/downtime-detector"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Downtime-detector</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link toc-highlight">Overview</a></li><li><a href="#key-components" class="table-of-contents__link toc-highlight">Key Components</a></li><li><a href="#creating-new-cosmwasm-pool" class="table-of-contents__link toc-highlight">Creating new CosmWasm Pool</a></li><li><a href="#providing--withdrawing-liquidity" class="table-of-contents__link toc-highlight">Providing / Withdrawing Liquidity</a></li><li><a href="#swap" class="table-of-contents__link toc-highlight">Swap</a></li><li><a href="#deactivating" class="table-of-contents__link toc-highlight">Deactivating</a></li><li><a href="#cosmwasm-pool-contract-interface" class="table-of-contents__link toc-highlight">CosmWasm Pool Contract Interface</a><ul><li><a href="#query" class="table-of-contents__link toc-highlight">Query</a></li><li><a href="#sudo" class="table-of-contents__link toc-highlight">Sudo</a></li></ul></li><li><a href="#incentives-and-shares" class="table-of-contents__link toc-highlight">Incentives and Shares</a></li><li><a href="#appendix" class="table-of-contents__link toc-highlight">Appendix</a><ul><li><a href="#twap" class="table-of-contents__link toc-highlight">TWAP</a></li><li><a href="#rust-deserialization" class="table-of-contents__link toc-highlight">Rust de/serialization</a></li><li><a href="#governance-and-code-id-management" class="table-of-contents__link toc-highlight">Governance and Code Id Management</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="margin-bottom--sm"><a class="footerLogoLink_DDai" href="/"><img src="/logo/light.svg" alt="Osmosis Docs" class="themedImage_ToTc themedImage--light_HNdA footer__logo" height="36px"><img src="/logo/dark.svg" alt="Osmosis Docs" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" height="36px"></a></div><div class="footer__row"><div class="footer__data"><div class="footer__cta"></div></div><div class="links"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://app.osmosis.zone" target="_blank" rel="noopener noreferrer" class="footer__link-item">Launch App</a></li><li class="footer__item"><a href="https://docs.osmosis.zone" target="_blank" rel="noopener noreferrer" class="footer__link-item">Developer Portal</a></li><li class="footer__item"><a href="https://osmosis.zone/ecosystem" target="_blank" rel="noopener noreferrer" class="footer__link-item">Ecosystem</a></li></ul></div><div class="col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://docs.osmosis.zone" target="_blank" rel="noopener noreferrer" class="footer__link-item">Documentation</a></li><li class="footer__item"><a href="https://medium.com/@Osmosis" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium</a></li><li class="footer__item"><a href="https://commonwealth.im/osmosis/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Community</a></li></ul></div></div></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © Osmosis Labs since 2023. All rights reserved.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.b0431ac5.js"></script>
<script src="/assets/js/main.853f4916.js"></script>
</body>
</html>